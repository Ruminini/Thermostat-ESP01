<!DOCTYPE html>
<html>
<head>
	<title>ESP-01 Thermostat</title>
</head>
<body>
	<h1>ESP-01 Thermostat</h1>
	<p>Temperature: <span id='temperature'></span>&#8451;</p>
	<p>Humidity: <span id='humidity'></span>%</p>
	<p>Relay State: <span id='relayState'></span></p>
	<button type='submit' onclick='toggleRelay()'>Turn <span id='relayButton'></span></button>
	<label for="targetTemp">Target Temperature: <span id="targetTempValue">20</span></label>
	<input type="range" id="targetTemp" min="5" max="30" step="0.5" value="20" oninput="updateValue('targetTemp')">
	<label for="hysteresis">Hysteresis: <span id="hysteresisValue">2</span></label>
	<input type="range" id="hysteresis" min="0" max="10" step="1" value="2" oninput="updateValue('hysteresis')">
	<label for="updatePeriod">Update Period: <span id="updatePeriodValue">300</span>sec</label>
	<input type="range" id="updatePeriod" min="15" max="600" step="15" value="300"  oninput="updateValue('updatePeriod')">
	<button type='submit' onclick='satValues()'>Save</button>
	<script>
		let relay = 'OFF';
		let updateForm = true;
		function toggleRelay() {
			fetch('/set?relay=' + (relay == 'ON' ? '1' : '0')).then(fetchData);
		}
		function updateValue(id) {
				const element = document.getElementById(id);
				const valueElement = document.getElementById(id + 'Value');
				valueElement.textContent = element.value;
		}
		function fetchData() {
			fetch('/data').then(response => response.json()).then(data => {
				relay = data.relay == 1 ? 'OFF' : 'ON';
				document.getElementById('temperature').innerText = data.temperature;
				document.getElementById('humidity').innerText = data.humidity;
				document.getElementById('relayState').innerText = relay;
				document.getElementById('relayButton').innerText = data.relay == 1 ? 'ON' : 'OFF';
				if (updateForm) {
					updateForm = false;
					const targetTemp = data.targetTemp;
					const hysteresis = data.hysteresis;
					const updatePeriod = data.updatePeriod/1000;
					document.getElementById('targetTemp').value = targetTemp;
					document.getElementById('hysteresis').value = hysteresis;
					document.getElementById('updatePeriod').value = updatePeriod;
					updateValue('targetTemp');
					updateValue('hysteresis');
					updateValue('numberInput');
				}
			});
		}
		function satValues() {
			updateForm = true;
			const targetTemp = document.getElementById("targetTemp").value;
			const hysteresis = document.getElementById("hysteresis").value;
			const updatePeriod = document.getElementById("updatePeriod").value;
			fetch('/set?targetTemp=' + targetTemp + '&hysteresis=' + hysteresis + '&updatePeriod=' + updatePeriod*1000).then(fetchData);
		}
		setInterval(fetchData, 5000);
		fetchData();
	</script>
</body>
</html>